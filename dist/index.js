(()=>{"use strict";var t={6:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleManager=void 0;const r=i(810),s=i(76);e.ParticleManager=class{constructor(t,e,i){this.count=600,this.store=new s.Storage("particles"),this.particles=this.createParticles(t,e,i),this.particlesGroups=this.store.get()||{},this.updateGroups(t),this.store.event((t=>{this.particlesGroups=t||{}}))}createParticles(t,e,i){const s=Array(this.count).fill(1);return 1===t.length?s.map(((e,i)=>r.Particle.create(t[0].id,t[0].color,i))):s.map(((s,n)=>{const o=this.getWindow(t,n),h=r.Particle.create(o.id,o.color,n);return h.update(e,o,i,1),h}))}getWindow(t,e){if(!this.particlesGroups)return t[0];const i=this.entities().find((([,t])=>t.includes(e)));return i&&t.find((t=>t.id==i[0]))||t[0]}commit(){this.store.save(this.particlesGroups)}entities(){return Object.entries(this.particlesGroups).map((([t,e])=>[Number(t),e]))}updateGroups(t){if(1===t.length)return this.particlesGroups={[t[0].id]:this.particles.map(((t,e)=>e))},this.commit();const e=this.entities(),i=Math.floor(this.count/t.length),r=this.diff(e.map((t=>t[0])),t.map((t=>t.id)));if(0===r.length)return;const s=r[0];if(e.length<t.length){const t=[];for(const r in e){const s=e[r][1];s.length>i&&(e[r][1]=s.slice(0,i),t.push(...s.slice(i,s.length)))}e.push([s,t]),this.particlesGroups=Object.fromEntries(e)}else{const i=e.find((([t])=>t===s)),r=e.filter((([t])=>t!==s));if(i){let e=i[1];const s=Math.ceil(e.length/t.length);for(const t in r){const i=Math.min(e.length,s);r[t][1]=[...r[t][1],...e.slice(0,i)],e=e.slice(i,e.length)}r[0][1].push(...e),this.particlesGroups=Object.fromEntries(r)}}this.commit()}diff(t,e){return t.filter((t=>!e.includes(t))).concat(e.filter((e=>!t.includes(e))))}update(t,e){this.particles=this.particles.map(((i,r)=>{const s=this.getWindow(t,r);return i.windowId===s.id||(i.windowId=s.id,i.color=s.color,i.x=i.absoluteX-e.currentX,i.y=i.absoluteY-e.currentY),i}))}getParticles(){return this.particles}onChange(t){this.store.event(t)}}},549:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WindowManager=void 0;const r=i(76),s=i(591),n=i(524);e.WindowManager=class{constructor(){this.store=new r.Storage("windows"),this.windows=this.getWindows(),this.window=this.getWindow(),this.windows.push(this.window),this.commit(),this.initEvents()}initEvents(){this.store.event((()=>{this.windows=this.getWindows()})),window.addEventListener("beforeunload",(()=>{this.removeWindow(this.window.id)}))}nextId(){return Math.max(...this.windows.map((t=>t.id)),0)+1}getWindows(){return(this.store.get()||[]).map((t=>s.BrowserWindow.fromJson(t)))}getWindow(){const t=this.getWinShape();return new s.BrowserWindow(this.nextId(),t.x,t.y,t.width,t.height,n.Color.windowColor())}didWindowUpdate(){const t=this.getWinShape();return t.x!=this.window.x||t.y!=this.window.y||t.width!=this.window.width||t.height!=this.window.height}updateWindow(){this.window.updateFromJson({id:this.window.id,color:this.window.color,...this.getWinShape()}),this.windows=this.windows.map((t=>t.id===this.window.id?this.window:t)),this.commit()}getWinShape(){return{x:window.screenLeft,y:window.screenTop,width:window.innerWidth,height:window.innerHeight}}removeWindow(t){this.windows=this.windows.filter((e=>e.id!==t)),this.commit()}commit(){this.store.save(this.windows.map((t=>t.toJson())))}update(){this.didWindowUpdate()&&this.updateWindow();for(const t of this.windows)t.update()}getWindowById(t){return this.windows.find((e=>e.id===t))}getCurrentWindow(){return this.window}getCurrentWindows(){return this.windows}onChange(t){this.store.event(t)}onClose(t){window.addEventListener("beforeunload",(()=>{t(this.windows.filter((t=>t.id!==this.window.id)))}))}}},591:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BrowserWindow=void 0;class i{constructor(t,e,i,r,s,n){this.id=t,this.x=e,this.currentX=e,this.y=i,this.currentY=i,this.width=r,this.height=s,this.color=n}static fromJson(t){return new i(t.id,t.x,t.y,t.width,t.height,t.color)}updateFromJson(t){this.id=t.id,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.color=t.color}update(){this.currentX+=.2*(this.x-this.currentX),this.currentY+=.2*(this.y-this.currentY)}toJson(){return{id:this.id,x:this.x,y:this.y,width:this.width,height:this.height,color:this.color}}center(){return{x:this.currentX+this.width/2,y:this.currentY+this.height/2}}}e.BrowserWindow=i},810:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Particle=void 0;const r=i(524);class s{constructor(t,e,i,r,s,n){this.angle=0,this.angleFactor=0,this.windowId=t,this.r=r,this.x=e,this.absoluteX=e,this.y=i,this.absoluteY=i,this.angleFactor=s,this.color=n,this.currentColor=n}static create(t,e,i){function r(t){const e=100*Math.sin(t);return e-Math.floor(e)}return new s(t,0,0,20+500*r(i),1+2*r(i*i),e)}update(t,e,i,r=.03){this.angle=i*this.angleFactor;const s=e.center();this.absoluteX=this.r*Math.cos(this.angle)+s.x,this.absoluteY=this.r*Math.sin(this.angle)+s.y,this.x+=(this.absoluteX-t.currentX-this.x)*r,this.y+=(this.absoluteY-t.currentY-this.y)*r,this.currentColor=this.currentColor.map(((t,e)=>t+(this.color[e]-t)*r))}getColor(){return r.Color.rgba(...this.currentColor)}}e.Particle=s},932:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;const r=i(549),s=i(780),n=i(87),o=i(6);e.Controller=class{constructor(){this.timer=new n.Timer,this.renderer=new s.Renderer,this.windowManager=new r.WindowManager,this.particleManager=new o.ParticleManager(this.windowManager.getCurrentWindows(),this.windowManager.getCurrentWindow(),this.timer.getTime()),this.particleManager.update(this.windowManager.getCurrentWindows(),this.windowManager.getCurrentWindow()),this.windowManager.onChange((()=>{this.particleManager.update(this.windowManager.getCurrentWindows(),this.windowManager.getCurrentWindow())})),this.particleManager.onChange((()=>{this.particleManager.update(this.windowManager.getCurrentWindows(),this.windowManager.getCurrentWindow())})),this.windowManager.onClose((t=>{this.particleManager.updateGroups(t)}))}render(){window.requestAnimationFrame(this.render.bind(this));const t=this.timer.getTime();this.renderer.nextFrame(),this.windowManager.update(),this.particleManager.getParticles().forEach((e=>{const i=this.windowManager.getWindowById(e.windowId);i&&(e.update(this.windowManager.getCurrentWindow(),i,t),this.renderer.renderParticle(e))}))}}},780:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;const r=i(524);e.Renderer=class{constructor(){this.canvas=document.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.setSize(),window.addEventListener("resize",this.setSize.bind(this)),this.initBody()}setSize(){this.canvas.height=window.innerHeight,this.canvas.width=window.innerWidth}initBody(){document.body.style.backgroundColor="black",document.body.style.overflow="hidden"}nextFrame(){this.ctx.fillStyle=r.Color.background,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}renderParticle(t){this.ctx.beginPath(),this.ctx.fillStyle=t.getColor(),this.ctx.arc(t.x,t.y,1,0,2*Math.PI),this.ctx.fill()}}},524:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;class i{static rgba(t,e,i,r=1){return`rgba(${t}, ${e}, ${i}, ${r})`}static hsla(t,e,i,r=1){return`hsla(${t}, ${e}%, ${i}%, ${r})`}static windowColor(){return i.hslToRgb(360*Math.random(),100,50)}static hslToRgb(t,e,i){i/=100;const r=e=>(e+t/30)%12,s=(e/=100)*Math.min(i,1-i),n=t=>i-s*Math.max(-1,Math.min(r(t)-3,Math.min(9-r(t),1)));return[255*n(0),255*n(8),255*n(4)]}}e.Color=i,i.background=i.rgba(0,0,0,.05)},76:function(t,e){var i,r=this&&this.__classPrivateFieldSet||function(t,e,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(t,i):s?s.value=i:e.set(t,i),i},s=this&&this.__classPrivateFieldGet||function(t,e,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:e.get(t)};Object.defineProperty(e,"__esModule",{value:!0}),e.Storage=void 0,e.Storage=class{constructor(t){i.set(this,void 0),r(this,i,t,"f")}save(t){try{localStorage.setItem(s(this,i,"f"),JSON.stringify(t))}catch(t){}}get(){try{const t=localStorage.getItem(s(this,i,"f"));if(t)return JSON.parse(t)}catch(t){}}event(t){addEventListener("storage",(e=>{e.key==s(this,i,"f")&&t(this.get())}))}},i=new WeakMap},87:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=void 0,e.Timer=class{constructor(){const t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),this.start=t.getTime()}getTime(){return((new Date).getTime()-this.start)/1e3}}}},e={};(new(function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(932).Controller)).render()})();